<script>
        let recipes = {};
        let currentRecipeId = null;
        let currentStep = 0;
        let currentPortions = 6;
        let originalPortions = 6;

        // Load recipes from uploaded files
        async function loadRecipesFromFiles(files) {
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');
            const errorMessage = document.getElementById('error-message');
            const uploadBtn = document.getElementById('upload-btn');
            
            loadingState.style.display = 'block';
            emptyState.style.display = 'none';
            errorMessage.style.display = 'none';
            uploadBtn.disabled = true;

            try {
                recipes = {};
                let loadedCount = 0;

                for (const file of files) {
                    // Nur .md, .markdown und .txt Dateien verarbeiten
                    if (file.name.endsWith('.md') || file.name.endsWith('.markdown') || file.name.endsWith('.txt')) {
                        try {
                            const markdown = await file.text();
                            const recipe = parseMarkdown(markdown);
                            const id = 'recipe_' + file.name.replace(/\.(md|markdown|txt)$/, '');
                            recipes[id] = recipe;
                            loadedCount++;
                        } catch (err) {
                            console.error(`Fehler beim Laden von ${file.name}:`, err);
                        }
                    }
                }

                loadingState.style.display = 'none';
                
                if (loadedCount === 0) {
                    errorMessage.textContent = 'Keine gÃ¼ltigen Rezept-Dateien gefunden. Bitte .md, .markdown oder .txt Dateien hochladen.';
                    errorMessage.style.display = 'block';
                }
                
                renderLibrary();
                
            } catch (error) {
                console.error('Fehler beim Laden der Rezepte:', error);
                loadingState.style.display = 'none';
                errorMessage.textContent = `Fehler beim Laden der Rezepte: ${error.message}`;
                errorMessage.style.display = 'block';
            } finally {
                uploadBtn.disabled = false;
            }
        }

        // Handle file upload
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length > 0) {
                loadRecipesFromFiles(files);
            }
        }

        // Handle folder upload
        function handleFolderUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length > 0) {
                loadRecipesFromFiles(files);
            }
        }
